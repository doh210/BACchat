(function(){function e(t,n,r){function i(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<r.length;o++)i(r[o]);return i}return e})()({1:[function(e,t,n){"use strict";function i(e){var t=e||{};this.bufferSize=t.bufferSize||8192,this.inputChannels=t.inputChannels||1,this.outputChannels=t.outputChannels||1,this.recording=!1,this.requestedAccess=!1,this.sampleRate=16e3,this.bufferUnusedSamples=new Float32Array(0),this.samplesAll=new Float32Array(2e7),this.samplesAllOffset=0,navigator.getUserMedia||(navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)}var r=e("./utils");i.prototype.onPermissionRejected=function(){console.log("Microphone.onPermissionRejected()"),this.requestedAccess=!1,this.onError("Permission to access the microphone rejeted.")},i.prototype.onError=function(e){console.log("Microphone.onError():",e)},i.prototype.onMediaStream=function(e){var t=window.AudioContext||window.webkitAudioContext;if(!t)throw new Error("AudioContext not available");this.audioContext||(this.audioContext=new t);var n=this.audioContext.createGain(),r=this.audioContext.createMediaStreamSource(e);r.connect(n),this.mic||(this.mic=this.audioContext.createScriptProcessor(this.bufferSize,this.inputChannels,this.outputChannels)),console.log("Microphone.onMediaStream(): sampling rate is:",this.sampleRate),this.mic.onaudioprocess=this._onaudioprocess.bind(this),this.stream=e,n.connect(this.mic),this.mic.connect(this.audioContext.destination),this.recording=!0,this.requestedAccess=!1,this.onStartRecording()},i.prototype._onaudioprocess=function(e){if(!this.recording)return;var t=e.inputBuffer.getChannelData(0);this.saveData(new Float32Array(t)),this.onAudio(this._exportDataBufferTo16Khz(new Float32Array(t)))},i.prototype.record=function(){if(!navigator.getUserMedia){this.onError("Browser doesn't support microphone input");return}if(this.requestedAccess)return;this.requestedAccess=!0,navigator.getUserMedia({audio:!0},this.onMediaStream.bind(this),this.onPermissionRejected.bind(this))},i.prototype.stop=function(){if(!this.recording)return;JSON.parse(localStorage.getItem("playback"))&&this.playWav(),this.recording=!1,this.stream.getTracks()[0].stop(),this.requestedAccess=!1,this.mic.disconnect(0),this.onStopRecording()},i.prototype._exportDataBufferTo16Khz=function(e){var t=null,n=e.length,r=this.bufferUnusedSamples.length;if(r>0){t=new Float32Array(r+n);for(var i=0;i<r;++i)t[i]=this.bufferUnusedSamples[i];for(i=0;i<n;++i)t[r+i]=e[i]}else t=e;var s=[-0.037935,-0.00089024,.040173,.019989,.0047792,-0.058675,-0.056487,-0.0040653,.14527,.26927,.33913,.26927,.14527,-0.0040653,-0.056487,-0.058675,.0047792,.019989,.040173,-0.00089024,-0.037935],o=this.audioContext.sampleRate/16e3,u=Math.floor((t.length-s.length)/o)+1,a=new ArrayBuffer(u*2),f=new DataView(a),l=0,c=32767,h=0;for(var i=0;i+s.length-1<t.length;i=Math.round(o*h)){var p=0;for(var d=0;d<s.length;++d)p+=t[i+d]*s[d];p*=c,f.setInt16(l,p,!0),l+=2,h++}var v=Math.round(o*h),m=t.length-v;if(m>0){this.bufferUnusedSamples=new Float32Array(m);for(i=0;i<m;++i)this.bufferUnusedSamples[i]=t[v+i]}else this.bufferUnusedSamples=new Float32Array(0);return new Blob([f],{type:"audio/l16"})};var s=function(e,t,n){console.log("length: "+t.length+" "+e);var r=1,i=16e3,s=t.length*i/e,o=new OfflineAudioContext(r,s,i),u=o.createBufferSource();u.buffer=t,o.oncomplete=function(e){var t=e.renderedBuffer.getChannelData(0);console.log("Done resampling: "+t.length+" samples produced");var r=0,i=32767,s=new ArrayBuffer(t.length*2),o=new DataView(s);for(var u=0;u<t.length;u++)o.setInt16(r,t[u]*i,!0),r+=2;n(new Blob([o],{type:"audio/l16"}))},u.connect(o.destination),u.start(0),o.startRendering()},o=function(e,t){var n=null,r=null,i=0,s=32767;n=new ArrayBuffer(t*2),r=new DataView(n);for(var o=0;o<e.length;o++)r.setInt16(i,e[o]*s,!0),i+=2;return new Blob([r],{type:"audio/l16"})};i.prototype._exportDataBuffer=function(e){r.exportDataBuffer(e,this.bufferSize)},i.prototype.onStartRecording=function(){},i.prototype.onStopRecording=function(){},i.prototype.onAudio=function(){},t.exports=i,i.prototype.saveData=function(e){for(var t=0;t<e.length;++t)this.samplesAll[this.samplesAllOffset+t]=e[t];this.samplesAllOffset+=e.length,console.log("samples: "+this.samplesAllOffset)},i.prototype.playWav=function(){var e=this.samplesAll.subarray(0,this.samplesAllOffset),t=this.encodeWav(e,1,this.audioContext.sampleRate),n=new Blob([t],{type:"audio/l16"}),r=window.URL.createObjectURL(n),i=new Audio;i.src=r,i.play()},i.prototype.encodeWav=function(e,t,n){console.log("#samples: "+e.length);var r=new ArrayBuffer(44+e.length*2),i=new DataView(r);return this.writeString(i,0,"RIFF"),i.setUint32(4,36+e.length*2,!0),this.writeString(i,8,"WAVE"),this.writeString(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,t,!0),i.setUint32(24,n,!0),i.setUint32(28,n*4,!0),i.setUint16(32,t*2,!0),i.setUint16(34,16,!0),this.writeString(i,36,"data"),i.setUint32(40,e.length*2,!0),this.floatTo16BitPCM(i,44,e),i},i.prototype.writeString=function(e,t,n){for(var r=0;r<n.length;r++)e.setUint8(t+r,n.charCodeAt(r))},i.prototype.floatTo16BitPCM=function(e,t,n){for(var r=0;r<n.length;r++,t+=2){var i=Math.max(-1,Math.min(1,n[r]));e.setInt16(t,i<0?i*32768:i*32767,!0)}}},{"./utils":8}],2:[function(e,t,n){t.exports={models:[{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/ar-AR_BroadbandModel",rate:16e3,name:"ar-AR_BroadbandModel",language:"ar-AR",description:"Modern Standard Arabic broadband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/en-UK_BroadbandModel",rate:16e3,name:"en-UK_BroadbandModel",language:"en-UK",description:"UK English broadband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/en-UK_NarrowbandModel",rate:8e3,name:"en-UK_NarrowbandModel",language:"en-UK",description:"UK English narrowband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/en-US_BroadbandModel",rate:16e3,name:"en-US_BroadbandModel",language:"en-US",description:"US English broadband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/en-US_NarrowbandModel",rate:8e3,name:"en-US_NarrowbandModel",language:"en-US",description:"US English narrowband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/es-ES_BroadbandModel",rate:16e3,name:"es-ES_BroadbandModel",language:"es-ES",description:"Spanish broadband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/es-ES_NarrowbandModel",rate:8e3,name:"es-ES_NarrowbandModel",language:"es-ES",description:"Spanish narrowband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/ja-JP_BroadbandModel",rate:16e3,name:"ja-JP_BroadbandModel",language:"ja-JP",description:"Japanese broadband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/ja-JP_NarrowbandModel",rate:8e3,name:"ja-JP_NarrowbandModel",language:"ja-JP",description:"Japanese narrowband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/pt-BR_BroadbandModel",rate:16e3,name:"pt-BR_BroadbandModel",language:"pt-BR",description:"Brazilian Portuguese broadband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/pt-BR_NarrowbandModel",rate:8e3,name:"pt-BR_NarrowbandModel",language:"pt-BR",description:"Brazilian Portuguese narrowband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/zh-CN_BroadbandModel",rate:16e3,name:"zh-CN_BroadbandModel",language:"zh-CN",description:"Mandarin broadband model."},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/zh-CN_NarrowbandModel",rate:8e3,name:"zh-CN_NarrowbandModel",language:"zh-CN",description:"Mandarin narrowband model."}]}},{}],3:[function(e,t,n){"use strict";var r=e("./views/displaymetadata"),i=e("./socket").initSocket;n.handleFileUpload=function(e,t,n,s,o,u,a){function h(){console.log("Socket opened")}function p(e){console.log("Socket listening"),u(e)}function d(e){e.results&&(f=r.showResult(e,f,n),l=r.showJSON(e,l))}function v(e){localStorage.setItem("currentlyDisplaying","false"),a(e),console.log("Socket err: ",e.code)}function m(e){localStorage.setItem("currentlyDisplaying","false"),a(e),console.log("Socket closing: ",e)}localStorage.setItem("currentlyDisplaying",e),$.subscribe("progress",function(e,t){console.log("progress: ",t)}),console.log("contentType",o);var f="",l="";$.subscribe("showjson",function(){var e=$("#resultsJSON");e.empty(),e.append(l)});var c={};c.token=t,c.message={action:"start","content-type":o,interim_results:!0,continuous:!0,word_confidence:!0,timestamps:!0,max_alternatives:3,inactivity_timeout:600},c.model=n,i(c,h,p,d,v,m)}},{"./socket":7,"./views/displaymetadata":10}],4:[function(e,t,n){"use strict";var r=e("./socket").initSocket,i=e("./views/displaymetadata");n.handleMicrophone=function(e,t,n,s){function l(e){console.log("Mic socket: opened"),s(null,e)}function c(e){n.onAudio=function(t){e.readyState<2&&e.send(t)}}function h(e){e.results&&(u=i.showResult(e,u,t),a=i.showJSON(e,a))}function p(){console.log("Mic socket err: ",o)}function d(e){console.log("Mic socket close: ",e)}if(t.indexOf("Narrowband")>-1){var o=new Error("Microphone transcription cannot accomodate narrowband models, please select another");return s(o,null),!1}$.publish("clearscreen");var u="",a="";$.subscribe("showjson",function(){var e=$("#resultsJSON");e.empty(),e.append(a)});var f={};f.token=e,f.message={action:"start","content-type":"audio/l16;rate=16000",interim_results:!0,continuous:!0,word_confidence:!0,timestamps:!0,max_alternatives:3,inactivity_timeout:600},f.model=t,r(f,l,c,h,p,d)}},{"./socket":7,"./views/displaymetadata":10}],5:[function(e,t,n){"use strict";var r=e("./data/models.json").models,i=e("./utils");i.initPubSub();var s=e("./views").initViews,o=e("./views/showerror"),u=o.showError,a=e("./models").getModels;window.BUFFERSIZE=8192,$(document).ready(function(){var e=i.createTokenGenerator();e.getToken(function(e,t){window.onbeforeunload=function(){localStorage.clear()},t||(console.error("No authorization token available"),console.error("Attempting to reconnect..."),e&&e.code?u("Server error "+e.code+": "+e.error):u("Server error "+e.code+": please refresh your browser and try again"));var n={currentModel:"en-US_BroadbandModel",models:r,token:t,bufferSize:BUFFERSIZE};s(n),localStorage.setItem("models",JSON.stringify(r)),localStorage.setItem("playbackON",!1);var i=window.location.search.substring(1),o=i.split("&");for(var f=0;f<o.length;f++){var l=o[f].split("=");decodeURIComponent(l[0])==="debug"&&localStorage.setItem("playbackON",decodeURIComponent(l[1]))}localStorage.setItem("currentModel","en-US_BroadbandModel"),localStorage.setItem("sessionPermissions","true"),a(t),$.subscribe("clearscreen",function(){$("#resultsText").text(""),$("#resultsJSON").text(""),$(".error-row").hide(),$(".notification-row").hide(),$(".hypotheses > ul").empty(),$("#metadataTableBody").empty(),toneChart.clearTimeLines()})})})},{"./data/models.json":2,"./models":6,"./utils":8,"./views":14,"./views/showerror":18}],6:[function(e,t,n){"use strict";var r=e("./views/selectmodel").initSelectModel;n.getModels=function(t){var n={currentModel:"en-US_BroadbandModel",models:null,token:t,bufferSize:BUFFERSIZE},i="https://stream.watsonplatform.net/speech-to-text/api/v1/models",s=new XMLHttpRequest;s.open("GET",i,!0),s.withCredentials=!0,s.setRequestHeader("Accept","application/json"),s.setRequestHeader("X-Watson-Authorization-Token",t),s.onload=function(){var e=JSON.parse(s.responseText),t=e.models.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0});e.models=t,localStorage.setItem("models",JSON.stringify(e.models)),n.models=e.models,r(n)},s.onerror=function(){n.models=e("./data/models.json").models,r(n)},s.send()}},{"./data/models.json":2,"./views/selectmodel":17}],7:[function(e,t,n){"use strict";var r=e("./utils"),i=e("./views/showerror"),s=i.showError,o=r.createTokenGenerator(),u=n.initSocket=function(e,t,n,r,i,a){function l(e,t){return typeof e=="undefined"?t:e}var f,c,h=e.token,p=e.model||localStorage.getItem("currentModel"),d=e.message||{action:"start"},v=l(e.sessionPermissions,JSON.parse(localStorage.getItem("sessionPermissions"))),m=e.serviceURI||"wss://stream.watsonplatform.net/speech-to-text/api/v1/recognize?watson-token=";m+=h+"&model="+p,console.log("URL model",p);try{c=new WebSocket(m)}catch(g){console.error("WS connection error: ",g)}c.onopen=function(){f=!1,$.subscribe("hardsocketstop",function(){console.log("MICROPHONE: close."),c.send(JSON.stringify({action:"stop"})),c.close()}),$.subscribe("socketstop",function(){console.log("MICROPHONE: close."),c.close()}),c.send(JSON.stringify(d)),t(c)},c.onmessage=function(e){var t=JSON.parse(e.data);if(t.error){s(t.error),$.publish("hardsocketstop");return}t.state==="listening"&&(f?(console.log("MICROPHONE: Closing socket."),c.close()):(n(c),f=!0)),r(t,c)},c.onerror=function(e){console.log("WS onerror: ",e),s("Application error "+e.code+": please refresh your browser and try again"),$.publish("clearscreen"),i(e)},c.onclose=function(s){$.ajax({type:"GET",url:"http://localhost:5000/api/v1/drunk?done=true"}).done(function(e){console.log("got a response",e),e.isDrunk?$("#displaybox").text("You are drunk"):$("#displaybox").text("You are sober")}),$("#displaybox").text("Loading"),console.log("WS onclose: ",s);if(s.code===1006){console.log("generator count",o.getCount());if(o.getCount()>1)throw $.publish("hardsocketstop"),new Error("No authorization token is currently available");return o.getToken(function(s,o){if(s)return $.publish("hardsocketstop"),!1;console.log("Fetching additional token..."),e.token=o,u(e,t,n,r,i,a)}),!1}if(s.code===1011)return console.error("Server error "+s.code+": please refresh your browser and try again"),!1;if(s.code>1e3)return console.error("Server error "+s.code+": please refresh your browser and try again"),!1;$.unsubscribe("hardsocketstop"),$.unsubscribe("socketstop"),a(s)}}},{"./utils":8,"./views/showerror":18}],8:[function(e,t,n){(function(e){"use strict";var t=typeof window!="undefined"?window.jQuery:typeof e!="undefined"?e.jQuery:null,r=function(e,t,n,r){var i=new FileReader,s=n.slice(e,t+e);i.onload=r,i.readAsArrayBuffer(s)};n.onFileProgress=function(e,t,n,i,s,o){var u=e.file,a=u.size,f=e.bufferSize||16e3,l=0,c=function(e){if(l>=a){console.log("Done reading file"),s();return}if(!n())return;if(e.target.error!=null){var d=e.target.error;console.log("Read error: "+d),i(d);return}var h=e.target.result,p=h.byteLength;l+=p,t(h),o?setTimeout(function(){r(l,f,u,c)},f*1e3/(o*2)):r(l,f,u,c)};r(l,f,u,c)},n.createTokenGenerator=function(){var e=0;return{getToken:function(n){++e;if(e>5){var r=new Error("Cannot reach server");n(null,r);return}var i="/api/token",s=new XMLHttpRequest;s.open("POST",i,!0),s.setRequestHeader("csrf-token",t('meta[name="ct"]').attr("content")),s.onreadystatechange=function(){if(s.readyState===4)if(s.status===200){var e=s.responseText;n(null,e)}else{var t="Cannot reach server";if(s.responseText)try{t=JSON.parse(s.responseText)}catch(r){t=s.responseText}n(t)}},s.send()},getCount:function(){return e}}},n.initPubSub=function(){var e=t({});t.subscribe=e.on.bind(e),t.unsubscribe=e.off.bind(e),t.publish=e.trigger.bind(e)}}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],9:[function(e,t,n){"use strict";n.initAnimatePanel=function(){$(".panel-heading span.clickable").on("click",function(){$(this).hasClass("panel-collapsed")?($(this).parents(".panel").find(".panel-body").slideDown(),$(this).removeClass("panel-collapsed"),$(this).find("i").removeClass("caret-down").addClass("caret-up")):($(this).parents(".panel").find(".panel-body").slideUp(),$(this).addClass("panel-collapsed"),$(this).find("i").removeClass("caret-up").addClass("caret-down"))})}},{}],10:[function(e,t,n){"use strict";function f(){if(!r){var e=$("#resultsText").get(0);e.scrollTop=e.scrollHeight}}function c(){if(!r){var e=$(".table-scroll").get(0);e.scrollTop=e.scrollHeight}}var r=!1,i=!1,s=function(e,t){var n=e[0],r=e[1],i=e[2],s=t?t[1].toString().substring(0,3):"n/a";$("#metadataTable > tbody:last-child").append("<tr><td>"+n+"</td>"+"<td>"+r+"</td>"+"<td>"+i+"</td>"+"<td>"+s+"</td>"+"</tr>")},o=function(e){var t=e.word_confidence,n=e.timestamps;if(t&&t.length>0){for(var r=0;r<t.length;r++){var i=n[r],o=t[r];s(i,o)}return}n&&n.length>0&&n.forEach(function(e){s(e)})},u=function(){var e="",t="",n="";this.clearString=function(){e="",t="",n=""},this.showAlternatives=function(r,i,s){var o=$(".hypotheses ol");o.empty(),r.forEach(function(r,i){var s;if(r.transcript){var u=r.transcript.replace(/%HESITATION\s/g,"");u=u.replace(/(.)\1{2,}/g,"");switch(i){case 0:e+=u,s=$("<li data-hypothesis-index="+i+" >"+e+"</li>");break;case 1:t+=u,s=$("<li data-hypothesis-index="+i+" >"+t+"</li>");break;case 2:n+=u,s=$("<li data-hypothesis-index="+i+" >"+n+"</li>")}o.append(s)}})}},a=new u;n.showJSON=function(e,t){var n=JSON.stringify(e,null,2);return t+=n,t+="\n",$(".nav-tabs .active").text()==="JSON"&&($("#resultsJSON").append(t),t="",console.log("updating json")),t};var l=function(){$("#resultsText").on("scroll",function(){i=!0})},h=function(){$(".table-scroll").on("scroll",function(){r=!0})};n.initDisplayMetadata=function(){h(),l()},n.showResult=function(e,t,n){if(e.results&&e.results.length>0){var r=e.results[0].alternatives,i=e.results[0].alternatives[0].transcript||"";i=i.replace(/%HESITATION\s/g,""),i=i.replace(/(.)\1{2,}/g,""),e.results[0].final&&console.log("-> "+i),i=i.replace(/D_[^\s]+/g,"");if(i.length===0||/^\s+$/.test(i))return t;var s=n.substring(0,5)==="ja-JP"||n.substring(0,5)==="zh-CN";e.results&&e.results[0]&&e.results[0].final?(i=i.slice(0,-1),i=i.charAt(0).toUpperCase()+i.substring(1),s?(i=i.trim()+"ã€‚",i=i.replace(/ /g,"")):i=i.trim()+". ",t+=i,$("#resultsText").val(t),getToneAnalysis(t),o(r[0]),a.showAlternatives(r)):(s?i=i.replace(/ /g,""):i=i.charAt(0).toUpperCase()+i.substring(1),$("#resultsText").val(t+i))}return c(),f(),t},$.subscribe("clearscreen",function(){var e=$(".hypotheses ul");r=!1,e.empty(),a.clearString()})},{}],11:[function(e,t,n){"use strict";var r=e("./fileupload").handleSelectedFile;n.initDragDrop=function(e){function n(t){var n=t.dataTransfer.files[0];r(e.token,n)}var t=$(document);t.on("dragenter",function(e){e.stopPropagation(),e.preventDefault()}),t.on("dragover",function(e){e.stopPropagation(),e.preventDefault()}),t.on("drop",function(e){console.log("File dropped"),e.preventDefault();var t=e.originalEvent;n(t)}),$(".upload-audio-file").click(function(t){t.preventDefault(),$(".upload-input").trigger("click"),$(".upload-input").change(function(){var t=$(".upload-input")[0].files[0];r(e.token,t)})})}},{"./fileupload":13}],12:[function(e,t,n){"use strict";n.flashSVG=function(e){function t(){e.animate({fill:"#A53725"},1e3,"linear").animate({fill:"white"},1e3,"linear")}e.css({fill:"#A53725"});var n=setTimeout(t,2e3);return n},n.stopFlashSVG=function(e){el.css({fill:"white"}),clearInterval(e)},n.toggleImage=function(e,t){e.attr("src")==="images/"+t+".svg"?e.attr("src","images/stop-red.svg"):e.attr("src","images/stop.svg")};var r=n.restoreImage=function(e,t){e.attr("src","images/"+t+".svg")};n.stopToggleImage=function(e,t,n){clearInterval(e),r(t,n)}},{}],13:[function(e,t,n){"use strict";var r=e("./showerror").showError,i=e("./showerror").showNotice,s=e("../handlefileupload").handleFileUpload,o=e("./effects"),u=e("../utils"),a=n.handleSelectedFile=function(){var e=!1;return localStorage.setItem("currentlyDisplaying","false"),function(t,n){function c(){clearInterval(f),o.restoreImage(a,"upload"),l.text("Select File")}$.publish("clearscreen"),localStorage.setItem("currentlyDisplaying","fileupload"),e=!0;var a=$("#fileUploadTarget > img"),f=setInterval(o.toggleImage,750,a,"stop"),l=$("#fileUploadTarget > span");l.text("Stop Transcribing"),$.subscribe("hardsocketstop",function(){c(),e=!1});var h=localStorage.getItem("currentModel");console.log("currentModel",h);var p=(new Blob([n])).slice(0,4),d=new FileReader;d.readAsText(p),d.onload=function(){var p;if(d.result==="fLaC")p="audio/flac",i("Notice: browsers do not support playing FLAC audio, so no audio will accompany the transcription");else if(d.result==="RIFF"){p="audio/wav";var v=new Audio,m=new Blob([n],{type:"audio/wav"}),g=URL.createObjectURL(m);v.src=g,v.play(),$.subscribe("hardsocketstop",function(){v.pause(),v.currentTime=0})}else{if(d.result!=="OggS"){c(),r("Only WAV or FLAC or Opus files can be transcribed, please try another file format"),localStorage.setItem("currentlyDisplaying","false");return}p="audio/ogg; codecs=opus";var v=new Audio,y=new Blob([n],{type:"audio/ogg; codecs=opus"}),b=URL.createObjectURL(y);v.src=b,v.play(),$.subscribe("hardsocketstop",function(){v.pause(),v.currentTime=0})}s("fileupload",t,h,n,p,function(t){var i=new Blob([n]),s={file:i};u.onFileProgress(s,function(n){t.send(n)},function(){return e?!0:!1},function(e){console.log("Error reading file: ",e.message),r("Error: "+e.message)},function(){t.send(JSON.stringify({action:"stop"}))})},function(){o.stopToggleImage(f,a,"upload"),l.text("Select File"),localStorage.setItem("currentlyDisplaying","false")})}}}();n.initFileUpload=function(e){var t=$("#fileUploadDialog");t.change(function(){var n=t.get(0).files[0];a(e.token,n)}),$("#fileUploadTarget").click(function(){var e=localStorage.getItem("currentlyDisplaying");if(e=="fileupload"){console.log("HARD SOCKET STOP"),$.publish("hardsocketstop"),localStorage.setItem("currentlyDisplaying","false");return}if(e=="sample"){r("Currently another file is playing, please stop the file or wait until it finishes");return}if(e=="record"){r("Currently audio is being recorded, please stop recording before playing a sample");return}t.val(null),t.trigger("click")})}},{"../handlefileupload":3,"../utils":8,"./effects":12,"./showerror":18}],14:[function(e,t,n){"use strict";var r=e("./animatepanel").initAnimatePanel,i=e("./showtab").initShowTab,s=e("./dragdrop").initDragDrop,o=e("./playsample").initPlaySample,u=e("./recordbutton").initRecordButton,a=e("./fileupload").initFileUpload,f=e("./displaymetadata").initDisplayMetadata;n.initViews=function(e){console.log("Initializing views..."),o(e),s(e),u(e),a(e),i(),r(),i(),f()}},{"./animatepanel":9,"./displaymetadata":10,"./dragdrop":11,"./fileupload":13,"./playsample":15,"./recordbutton":16,"./showtab":19}],15:[function(e,t,n){"use strict";var r=e("../utils"),i=r.onFileProgress,s=e("../handlefileupload").handleFileUpload,o=e("./showerror").showError,u=e("./effects"),a={"ar-AR_BroadbandModel":["ar-AR_Broadband_sample1.wav","ar-AR_Broadband_sample2.wav"],"en-UK_BroadbandModel":["en-UK_Broadband_sample1.wav","en-UK_Broadband_sample2.wav"],"en-UK_NarrowbandModel":["en-UK_Narrowband_sample1.wav","en-UK_Narrowband_sample2.wav"],"en-US_BroadbandModel":["Us_English_Broadband_Sample_1.wav","Us_English_Broadband_Sample_2.wav"],"en-US_NarrowbandModel":["Us_English_Narrowband_Sample_1.wav","Us_English_Narrowband_Sample_2.wav"],"es-ES_BroadbandModel":["Es_ES_spk24_16khz.wav","Es_ES_spk19_16khz.wav"],"es-ES_NarrowbandModel":["Es_ES_spk24_8khz.wav","Es_ES_spk19_8khz.wav"],"ja-JP_BroadbandModel":["sample-Ja_JP-wide1.wav","sample-Ja_JP-wide2.wav"],"ja-JP_NarrowbandModel":["sample-Ja_JP-narrow3.wav","sample-Ja_JP-narrow4.wav"],"pt-BR_BroadbandModel":["pt-BR_Sample1-16KHz.wav","pt-BR_Sample2-16KHz.wav"],"pt-BR_NarrowbandModel":["pt-BR_Sample1-8KHz.wav","pt-BR_Sample2-8KHz.wav"],"zh-CN_BroadbandModel":["zh-CN_sample1_for_16k.wav","zh-CN_sample2_for_16k.wav"],"zh-CN_NarrowbandModel":["zh-CN_sample1_for_8k.wav","zh-CN_sample2_for_8k.wav"]},f=function(){var e=!1;return localStorage.setItem("currentlyDisplaying","false"),localStorage.setItem("samplePlaying","false"),function(t,n,r,a,f){$.publish("clearscreen");var l=localStorage.getItem("currentlyDisplaying"),c=localStorage.getItem("samplePlaying");if(c===r){console.log("HARD SOCKET STOP"),$.publish("socketstop"),localStorage.setItem("currentlyDisplaying","false"),localStorage.setItem("samplePlaying","false"),u.stopToggleImage(h,n,a),u.restoreImage(n,a),e=!1;return}if(l==="record"){o("Currently audio is being recorded, please stop recording before playing a sample");return}if(l==="fileupload"||c!=="false"){o("Currently another file is playing, please stop the file or wait until it finishes");return}localStorage.setItem("currentlyDisplaying","sample"),localStorage.setItem("samplePlaying",r),e=!0,$("#resultsText").val("");var h=setInterval(u.toggleImage,750,n,a),p=new XMLHttpRequest;p.open("GET",f,!0),p.responseType="blob",p.onload=function(){var r=p.response,o=localStorage.getItem("currentModel")||"en-US_BroadbandModel",f=new FileReader,l=(new Blob([r])).slice(0,4);f.readAsText(l),f.onload=function(){var l=f.result==="fLaC"?"audio/flac":"audio/wav";console.log("Uploading file",f.result);var c=URL.createObjectURL(r),p=new Audio;p.src=c,p.play(),$.subscribe("hardsocketstop",function(){p.pause(),p.currentTime=0}),$.subscribe("socketstop",function(){p.pause(),p.currentTime=0}),s("sample",t,o,r,l,function(t){var n={file:r},s=o.indexOf("Broadband")!==-1?16e3:8e3;i(n,function(n){t.send(n)},function(){return e?!0:!1},function(e){console.log("Error reading file: ",e.message)},function(){t.send(JSON.stringify({action:"stop"}))})},function(){u.stopToggleImage(h,n,a),u.restoreImage(n,a),localStorage.getItem("currentlyDisplaying","false"),localStorage.setItem("samplePlaying","false")})}},p.send()}}();n.initPlaySample=function(e){(function(){var t="audio/"+a[e.currentModel][0],n=$(".play-sample-1");n.off("click");var r="play",i=n.find("img");n.click(function(){f(e.token,i,"sample-1",r,t,function(e){console.log("Play sample result",e)})})})(e,a),function(){var t="audio/"+a[e.currentModel][1],n=$(".play-sample-2");n.off("click");var r="play",i=n.find("img");n.click(function(){f(e.token,i,"sample-2",r,t,function(e){console.log("Play sample result",e)})})}(e,a)}},{"../handlefileupload":3,"../utils":8,"./effects":12,"./showerror":18}],16:[function(e,t,n){"use strict";var r=e("../Microphone"),i=e("../handlemicrophone").handleMicrophone,s=e("./showerror").showError;n.initRecordButton=function(e){var t=$("#recordButton");t.click(function(){var n=!1,o=e.token,u={bufferSize:e.buffersize},a=new r(u);return function(e){e.preventDefault();var r=localStorage.getItem("currentModel"),u=localStorage.getItem("currentlyDisplaying");if(u=="sample"||u=="fileupload"){s("Currently another file is playing, please stop the file or wait until it finishes");return}localStorage.setItem("currentlyDisplaying","record"),n?(console.log("Stopping microphone, sending stop action message"),t.removeAttr("style"),t.find("img").attr("src","images/microphone.svg"),$.publish("hardsocketstop"),a.stop(),n=!1,localStorage.setItem("currentlyDisplaying","false")):($("#resultsText").val(""),console.log("Not running, handleMicrophone()"),i(o,r,a,function(e){if(e){var r="Error: "+e.message;console.log(r),s(r),n=!1,localStorage.setItem("currentlyDisplaying","false")}else t.css("background-color","#d74108"),t.find("img").attr("src","images/stop.svg"),console.log("starting mic"),a.record(),n=!0}))}}())}},{"../Microphone":1,"../handlemicrophone":4,"./showerror":18}],17:[function(e,t,n){"use strict";var r=e("./playsample").initPlaySample;n.initSelectModel=function(e){e.models.forEach(function(e){$("#dropdownMenuList").append($("<li>").attr("role","presentation").append($("<a>").attr("role","menu-item").attr("href","/").attr("data-model",e.name).append(e.description.substring(0,e.description.length-1),e.rate==8e3?" (8KHz)":" (16KHz)")))}),$("#dropdownMenuList").click(function(t){t.preventDefault(),t.stopPropagation(),console.log("Change view",$(t.target).text());var n=$(t.target).text(),i=$(t.target).data("model");$("#dropdownMenuDefault").empty().text(n),$("#dropdownMenu1").dropdown("toggle"),localStorage.setItem("currentModel",i),e.currentModel=i,r(e),$.publish("clearscreen")})}},{"./playsample":15}],18:[function(e,t,n){"use strict";n.showError=function(e){console.log("Error: ",e);var t=$(".error-row");t.hide(),t.css("background-color","#d74108"),t.css("color","white");var n=$("#errorMessage");n.text(e),t.show(),$("#errorClose").click(function(e){return e.preventDefault(),t.hide(),!1})},n.showNotice=function(e){console.log("Notice: ",e);var t=$(".notification-row");t.hide(),t.css("border","2px solid #ececec"),t.css("background-color","#f4f4f4"),t.css("color","black");var n=$("#notificationMessage");n.text(e),t.show(),$("#notificationClose").click(function(e){return e.preventDefault(),t.hide(),!1})},n.hideError=function(){var e=$(".error-row");e.hide()}},{}],19:[function(e,t,n){"use strict";n.initShowTab=function(){$('.nav-tabs a[data-toggle="tab"]').on("shown.bs.tab",function(e){var t=$(e.target).text();t==="JSON"&&$.publish("showjson")})}},{}]},{},[5]);